<!DOCTYPE html>
<html>
    <head>
        <title>Active Learning Tool - Home</title>
        <style>
            body {
                background-color: #EEB211;
            }
            h2 {
                text-align: center;
            }
            #question-panel {
                background-color: #2C2C2B;
                color: white;
                display: inline-block;
                min-width: 45%;
                min-height: 500px;
                border: 1px solid black;
                float: right;
            }
            #droppable {
                background-color: #2C2C2B;
                color: white;
                display: inline-block;
                min-width: 45%;
                min-height: 500px;
                border: 1px solid black;
            }
        </style>
        <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
        <script>
            $(function() {
                document.getElementById('questionCreator').style.display = 'none';
                $( '#draggable' ).draggable();
                $( '#droppable' ).droppable({
                  drop: function(event, ui) {
                    $(this)
                      .addClass('ui-state-highlight')
                      .find('p')
                        .html('Dropped!');
                  }
                });
            });
            function displayQuestionForm(){
                var e = document.getElementById('questionCreator');
                e.style.display = ((e.style.display != 'none') ? 'none' : 'block');
                var b = document.getElementById('createButton');
                b.firstChild.data = ((b.firstChild.data != 'Create Question') ? 'Create Question' : 'Hide Question') ;
            }
            function readURL(input) {
                if (input.files && input.files[0]) {
                    var reader = new FileReader();

                    reader.onload = function (e) {
                        $('#imageInput')
                            .attr('src', e.target.result)
                            .width(300)
                            .height(180);
                    };
                    reader.readAsDataURL(input.files[0]);
                }
            }
            
            var questions = [];
            var quizzes = [];
            
            var socket;
            function connect() {
                console.log('Connecting...');
                var s = new WebSocket('ws://localhost:1337');
                s.onopen = function() {
                    socket = s;
                    console.log('Connected to server!');
                    socket.send(JSON.stringify({
                        username: 'Professor'
                    }));
                    socket.send(JSON.stringify({ get_quizzes: true }));
                    socket.send(JSON.stringify({ get_questions: true }));
                };
                s.onmessage = function(msg) {
                    var data = JSON.parse(msg.data);
                    console.log('Received: ' + JSON.stringify(data, null, 4));
                };
                s.onclose = function() {
                    console.log('Connection closed.');
                    setTimeout(connect, 1000);
                };
            }

            connect();

            function createQuestion(name, answers, correct, image) {
                socket.send(JSON.stringify({ create_question: { name: name, answers: answers, correct: correct, image: image } }));
            }

            function getQuestions() {
                socket.send(JSON.stringify({ get_questions: true }));
            }
        </script>
    </head>
    <body>
        <h1>Active Learning Tool</h1>

        <div id="panels">
            <div id="droppable" class="ui-widget-header">
                <h2>Quizzes</h2>
                <p>Drop here</p>
            </div>
            <div id="question-panel">
                <h2>Questions</h2>
                <button type="button" onclick="displayQuestionForm()" id="createButton">Create Question</button>
                <div id="draggable" class="ui-widget-content">
                  <p>Drag me to my target</p>
                </div>
                <div id="questionCreator">
                    <form name="QuestionForm">
                        <fieldset>
                            <label for="question">Question:</label><br>
                            <input type="text" id="question" name="question" value="" size="75"><br>
                            <label for="answer1">Answer 1:</label><br>
                            <input type="text" id="answer1" name="answer1" value="" size="35">
                            <input type="radio" name="correct" value="0" checked>Correct</input><br>
                            <label for="answer2">Answer 2:</label><br>
                            <input type="text" id="answer2" name="answer2" value="" size="35">
                            <input type="radio" name="correct" value="1">Correct</input><br>
                            <label for="answer3">Answer 3:</label><br>
                            <input type="text" id="answer3" name="answer3" value="" size="35">
                            <input type="radio" name="correct" value="2">Correct</input><br>
                            <label for="answer4">Answer 4:</label><br>
                            <input type="text" id="answer4" name="answer4" value="" size="35">
                            <input type="radio" name="correct" value="3">Correct</input><br>

                            <input id="fileInput" type="file" onchange="readURL(this);"/>
                            <div>
                               <img id="imageInput" src="" alt="Please choose an image" name="imageInput"/>
                            </div>
                            <br>
                            <button type="button" onclick="createQuestion(question.value, [answer1.value, answer2.value, answer3.value, answer4.value], correct.value,
                            $('#imageInput').attr('src'))">
                                submit
                            </button>
                        </fieldset>
                    </form>
                </div>
            </div>
        </div>

        <button onclick="getQuestions()">Get Questions!</button>
    </body>
</html>
